# Project 5: Network Traffic Analysis of a Trojan

## Introduction
A Trojan is a type of malware that often masquerades as legitimate software but performs malicious activities once executed. These activities frequently include communicating with a command-and-control (C2) server to receive instructions or exfiltrate data. Analyzing the network traffic generated by a Trojan can reveal its communication patterns and help identify malicious domains or IP addresses. In this project, you will analyze the network traffic of a Trojan to understand its communication mechanisms.

## Pre-requisites
- Basic understanding of malware and its types, particularly Trojans.
- Familiarity with networking concepts and protocols (e.g., TCP/IP, HTTP).
- Knowledge of network traffic analysis tools.

## Lab Set-up
1. Operating System: Use a Windows virtual machine (VM) created using VirtualBox or VMware.
2. Trojan Sample: Obtain a known and safe-to-analyze Trojan sample from a reputable source like MalwareBazaar.
3. Tools:
  - Wireshark: For capturing and analyzing network traffic.
  - Procmon (Process Monitor): For monitoring file system, registry, and process/thread activity.
  - FakeNet-NG: For simulating network services and capturing malware communication.
    
Ensure your VM is isolated from your main network and has a snapshot taken before analysis to easily revert to a clean state.

## Exercise: Capturing and Analyzing Network Traffic
Objective: Execute the Trojan sample in a controlled environment and use Wireshark to capture and analyze its network traffic to identify communication patterns, protocols used, and any malicious domains or IP addresses.

Step 1: Set Up the Environment:

- Ensure the VM is isolated from your main network.
- Install and configure the necessary tools: Wireshark, Procmon, and FakeNet-NG.
- Take a snapshot of the VM for easy restoration.
- Start FakeNet-NG to simulate network services and capture the Trojan's communication.

Step 2: Initial Preparation:

- Start Wireshark to begin capturing network traffic on the VM.
- Start Procmon to monitor system activity (optional for additional context).

Step 3: Execute the Trojan Sample:

- Execute the Trojan sample within the VM.
- Allow the Trojan to run for a sufficient period to observe its network activity.

Step 4: Stop Capturing:

- Stop Wireshark after capturing enough traffic.
- Save the captured traffic data for analysis.

Step 5: Analyze the Network Traffic:

- Filter and Inspect Traffic: Use Wireshark to filter the traffic related to the Trojan. Common filters include ip.addr == <Trojan IP> or tcp.port == <specific port>.
- Identify Protocols: Determine the protocols used by the Trojan (e.g., HTTP, HTTPS, DNS).
- Examine Communication Patterns: Look for repetitive patterns, such as regular pings to a C2 server or data exfiltration attempts.
- Identify Malicious Domains/IPs: Note any suspicious domains or IP addresses the Trojan tries to contact.

## Expected Solution/Output:

- Filtering Traffic: Apply a filter in Wireshark to isolate the Trojan's traffic. For example:

```
ip.addr == 192.168.56.101
```
This filter isolates traffic to and from the IP address of the VM running the Trojan.

- Identifying Protocols: Analyze the traffic and identify the protocols used by the Trojan. For example:

```
Protocol: HTTP
Destination: malicious-domain.com
URL: http://malicious-domain.com/command
```
This indicates the Trojan is using HTTP to communicate with a malicious domain.

- Examining Communication Patterns: Observe the communication patterns. You might see the Trojan regularly checking in with the C2 server. Example findings:

```
GET /status HTTP/1.1
Host: malicious-domain.com
```
This indicates the Trojan is sending periodic HTTP GET requests to check in with the C2 server.

- Identifying Malicious Domains/IPs: Note the domains or IPs contacted by the Trojan. Example findings:

```
IP Address: 203.0.113.45
Domain: c2.malicious-domain.com
```
This information can be used to block these domains/IPs and understand the extent of the Trojan's network activity.

By completing this exercise, you will gain practical experience in capturing and analyzing network traffic generated by a Trojan. This knowledge is essential for identifying and mitigating malicious communication channels used by malware.
